# pip install cohere

import pinecone
from cohere import Client as CohereClient
import os

# Load API keys from .env
from dotenv import load_dotenv
load_dotenv()

# Initialize clients
co = CohereClient(os.getenv("COHERE_API_KEY"))
pinecone.init(api_key=os.getenv("PINECONE_API_KEY"), environment=os.getenv("PINECONE_ENVIRONMENT"))
pinecone_index = pinecone.Index(os.getenv("PINECONE_INDEX_NAME"))

def read_transcript(path: str) -> str:
    with open(path, "r", encoding="utf-8") as f:
        return f.read()

def get_embedding(text: str) -> list:
    return co.embed(texts=[text], model="embed-english-v3.0").embeddings[0]

def upsert_to_pinecone(embedding: list, metadata: dict):
    vector_id = f"{metadata['project_id']}_chunk_{metadata['chunk_index']}"
    pinecone_index.upsert(
        vectors=[
            {
                "id": vector_id,
                "values": embedding,
                "metadata": metadata
            }
        ],
        namespace=metadata["project_id"]
    )
